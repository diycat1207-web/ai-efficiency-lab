<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Efficiency Lab â€” ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg: #0a0a0f;
      --bg2: #12121a;
      --card: #1a1a2e;
      --border: rgba(255,255,255,0.06);
      --text: #e8e8f0;
      --text2: #9898b0;
      --text3: #6a6a80;
      --accent: #6c5ce7;
      --accent2: #a29bfe;
      --green: #00b894;
      --blue: #0984e3;
      --orange: #fdcb6e;
      --font: 'Inter','Noto Sans JP',-apple-system,sans-serif;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:var(--font); background:var(--bg); color:var(--text); min-height:100vh; }
    .dashboard { max-width:1200px; margin:0 auto; padding:2rem; }
    .header { display:flex; justify-content:space-between; align-items:center; margin-bottom:2rem; }
    .header h1 { font-size:1.5rem; font-weight:600; }
    .header h1 span { color:var(--accent2); }
    .refresh-btn { background:var(--accent); color:#fff; border:none; padding:0.5rem 1.2rem; border-radius:8px; cursor:pointer; font-family:var(--font); font-size:0.85rem; transition:0.3s; }
    .refresh-btn:hover { background:var(--accent2); }
    .status-bar { display:flex; gap:0.5rem; align-items:center; font-size:0.8rem; color:var(--text3); margin-bottom:2rem; }
    .status-dot { width:8px; height:8px; border-radius:50%; background:var(--green); animation:pulse 2s infinite; }
    @keyframes pulse { 0%,100%{opacity:1} 50%{opacity:0.4} }

    .stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(220px,1fr)); gap:1.2rem; margin-bottom:2rem; }
    .stat-card { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:1.5rem; transition:0.3s; }
    .stat-card:hover { border-color:rgba(255,255,255,0.12); transform:translateY(-2px); }
    .stat-label { font-size:0.8rem; color:var(--text3); margin-bottom:0.5rem; text-transform:uppercase; letter-spacing:0.05em; }
    .stat-value { font-size:2.2rem; font-weight:700; background:linear-gradient(135deg,var(--accent),#00cec9); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
    .stat-change { font-size:0.75rem; color:var(--green); margin-top:0.3rem; }

    .chart-section { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:1.5rem; margin-bottom:2rem; }
    .chart-title { font-size:1rem; font-weight:600; margin-bottom:1rem; }
    .chart-container { width:100%; height:280px; position:relative; }
    .chart-bar-container { display:flex; align-items:flex-end; gap:6px; height:240px; padding-top:10px; }
    .chart-bar-group { flex:1; display:flex; flex-direction:column; align-items:center; gap:4px; }
    .chart-bar { width:100%; min-width:20px; border-radius:6px 6px 0 0; transition:0.3s; cursor:pointer; }
    .chart-bar.articles { background:linear-gradient(180deg,var(--accent),var(--accent2)); }
    .chart-bar.sns { background:linear-gradient(180deg,#00cec9,#00b894); }
    .chart-bar:hover { opacity:0.8; transform:scaleY(1.05); transform-origin:bottom; }
    .chart-label { font-size:0.65rem; color:var(--text3); writing-mode:horizontal-tb; white-space:nowrap; }
    .chart-legend { display:flex; gap:1.5rem; margin-top:1rem; justify-content:center; }
    .legend-item { display:flex; align-items:center; gap:0.4rem; font-size:0.75rem; color:var(--text2); }
    .legend-dot { width:10px; height:10px; border-radius:3px; }

    .log-section { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:1.5rem; }
    .log-title { font-size:1rem; font-weight:600; margin-bottom:1rem; }
    .log-entries { max-height:300px; overflow-y:auto; font-family:'Cascadia Code',monospace; font-size:0.8rem; line-height:1.8; }
    .log-entry { padding:0.3rem 0; border-bottom:1px solid var(--border); color:var(--text2); }
    .log-entry .time { color:var(--text3); margin-right:0.5rem; }
    .log-entry .success { color:var(--green); }
    .log-entry .error { color:#e74c3c; }

    .empty-state { text-align:center; padding:3rem; color:var(--text3); }
    .empty-state .icon { font-size:3rem; margin-bottom:1rem; }
    .keyword-section { background:var(--card); border:1px solid var(--border); border-radius:16px; padding:1.5rem; margin-bottom:2rem; }
    .keyword-grid { display:flex; flex-wrap:wrap; gap:0.5rem; margin-top:1rem; }
    .keyword-tag { padding:0.3rem 0.8rem; background:rgba(108,92,231,0.15); color:var(--accent2); border-radius:6px; font-size:0.75rem; }
    .keyword-tag.used { background:rgba(255,255,255,0.05); color:var(--text3); text-decoration:line-through; }
  </style>
</head>
<body>
  <div class="dashboard">
    <div class="header">
      <h1>âš¡ <span>AI Efficiency Lab</span> ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
      <button class="refresh-btn" onclick="loadData()">ğŸ”„ æ›´æ–°</button>
    </div>
    <div class="status-bar">
      <div class="status-dot"></div>
      <span id="statusText">ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ä¸­...</span>
    </div>

    <div class="stats-grid" id="statsGrid">
      <div class="stat-card">
        <div class="stat-label">ğŸ“„ å…¬é–‹è¨˜äº‹æ•°</div>
        <div class="stat-value" id="totalArticles">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">ğŸ¦ SNSæŠ•ç¨¿æ•°</div>
        <div class="stat-value" id="totalSns">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">ğŸ“… é‹ç”¨æ—¥æ•°</div>
        <div class="stat-value" id="totalDays">0</div>
      </div>
      <div class="stat-card">
        <div class="stat-label">ğŸ”‘ æ®‹ã‚Šã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰</div>
        <div class="stat-value" id="remainingKeywords">0</div>
      </div>
    </div>

    <div class="chart-section">
      <div class="chart-title">ğŸ“Š æ—¥åˆ¥ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç”Ÿæˆæ•°</div>
      <div class="chart-container">
        <div class="chart-bar-container" id="chartBars"></div>
      </div>
      <div class="chart-legend">
        <div class="legend-item"><div class="legend-dot" style="background:var(--accent)"></div> è¨˜äº‹</div>
        <div class="legend-item"><div class="legend-dot" style="background:#00cec9"></div> SNSæŠ•ç¨¿</div>
      </div>
    </div>

    <div class="keyword-section">
      <div class="chart-title">ğŸ”‘ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä½¿ç”¨çŠ¶æ³</div>
      <div class="keyword-grid" id="keywordGrid"></div>
    </div>

    <div class="log-section">
      <div class="log-title">ğŸ“‹ æœ€è¿‘ã®ãƒ­ã‚°</div>
      <div class="log-entries" id="logEntries">
        <div class="empty-state">
          <div class="icon">ğŸ“­</div>
          <p>ã¾ã ãƒ­ã‚°ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ‡ã‚¤ãƒªãƒ¼ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã¯å®Ÿè¡Œç’°å¢ƒã«åˆã‚ã›ã¦è¨­å®š
    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¯ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦é–‹ããŸã‚ã€
    // fetch APIã®ä»£ã‚ã‚Šã«FileReader or fs.readFileã‚’ä½¿ç”¨
    // ãŸã ã—ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ãŸã‚
    // è»½é‡HTTPã‚µãƒ¼ãƒãƒ¼çµŒç”±ã§èª­ã¿è¾¼ã‚€

    const STATS_PATH = '../scripts/stats.json';
    const KEYWORDS_PATH = '../scripts/keywords.json';

    async function loadData() {
      try {
        // stats.json ã‚’èª­ã¿è¾¼ã¿
        const statsRes = await fetch(STATS_PATH);
        if (statsRes.ok) {
          const stats = await statsRes.json();
          document.getElementById('totalArticles').textContent = stats.articles || 0;
          document.getElementById('totalSns').textContent = stats.snsPosts || 0;

          if (stats.history && stats.history.length > 0) {
            document.getElementById('totalDays').textContent = stats.history.length;
            renderChart(stats.history);
          }
        }
      } catch {
        console.log('stats.json ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸï¼ˆåˆå›èµ·å‹•æ™‚ã¯æ­£å¸¸ã§ã™ï¼‰');
      }

      try {
        // keywords.json ã‚’èª­ã¿è¾¼ã¿
        const kwRes = await fetch(KEYWORDS_PATH);
        if (kwRes.ok) {
          const kwData = await kwRes.json();
          const allKw = kwData.categories.flatMap(c => c.keywords);
          const used = kwData.usedKeywords || [];
          document.getElementById('remainingKeywords').textContent = allKw.length - used.length;
          renderKeywords(allKw, used);
        }
      } catch {
        console.log('keywords.json ã‚’èª­ã¿è¾¼ã‚ã¾ã›ã‚“ã§ã—ãŸ');
      }

      document.getElementById('statusText').textContent =
        `æœ€çµ‚æ›´æ–°: ${new Date().toLocaleString('ja-JP')}`;
    }

    function renderChart(history) {
      const container = document.getElementById('chartBars');
      container.innerHTML = '';

      const last14 = history.slice(-14);
      const maxVal = Math.max(
        ...last14.map(h => Math.max(h.articles || 0, h.snsPosts || 0)),
        1
      );

      last14.forEach(day => {
        const group = document.createElement('div');
        group.className = 'chart-bar-group';

        const articleBar = document.createElement('div');
        articleBar.className = 'chart-bar articles';
        articleBar.style.height = `${((day.articles || 0) / maxVal) * 200}px`;
        articleBar.title = `è¨˜äº‹: ${day.articles || 0}`;

        const snsBar = document.createElement('div');
        snsBar.className = 'chart-bar sns';
        snsBar.style.height = `${((day.snsPosts || 0) / maxVal) * 200}px`;
        snsBar.title = `SNS: ${day.snsPosts || 0}`;

        const label = document.createElement('div');
        label.className = 'chart-label';
        label.textContent = day.date.slice(5); // MM-DD

        const barWrapper = document.createElement('div');
        barWrapper.style.cssText = 'display:flex;gap:3px;align-items:flex-end;height:200px;width:100%';
        barWrapper.appendChild(articleBar);
        barWrapper.appendChild(snsBar);

        group.appendChild(barWrapper);
        group.appendChild(label);
        container.appendChild(group);
      });
    }

    function renderKeywords(all, used) {
      const container = document.getElementById('keywordGrid');
      container.innerHTML = '';

      all.forEach(kw => {
        const tag = document.createElement('span');
        tag.className = `keyword-tag${used.includes(kw) ? ' used' : ''}`;
        tag.textContent = kw;
        container.appendChild(tag);
      });
    }

    // åˆæœŸèª­ã¿è¾¼ã¿
    loadData();
    // 30ç§’ã”ã¨ã«è‡ªå‹•æ›´æ–°
    setInterval(loadData, 30000);
  </script>
</body>
</html>
